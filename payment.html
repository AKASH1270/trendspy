<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trendspy ‚Äî Fashion Checkout</title>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
:root {
  --bg:#0b0f1e;
  --card:rgba(255,255,255,0.06);
  --accent:#ec4899;
  --accent2:#8b5cf6;
  --success:#22c55e;
  --danger:#ef4444;
  --muted:#a1a1aa;
  font-family:'Poppins',sans-serif;
  color:#f5f5f5;
}
body {
  margin:0;
  background:radial-gradient(circle at top, #1a1035 0%, #0a0f1f 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
}
.card {
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:18px;
  padding:28px;
  width:95%;
  max-width:440px;
  box-shadow:0 0 25px rgba(236,72,153,0.15);
  backdrop-filter:blur(10px);
}
h2 {
  text-align:center;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-size:24px;
  margin-bottom:18px;
}
.summary {
  background:rgba(255,255,255,0.05);
  padding:14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  margin-bottom:20px;
}
.summary div {
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin:4px 0;
}
.method {
  margin-top:15px;
}
.method label {
  display:block;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.06);
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  transition:0.3s;
}
.method label:hover {
  background:rgba(255,255,255,0.08);
}
input[type="radio"] {
  accent-color:var(--accent);
  margin-right:8px;
}
button {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
  font-size:15px;
  margin-top:10px;
  transition:.3s;
}
button.primary {
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#fff;
  box-shadow:0 0 10px rgba(236,72,153,0.4);
}
button.primary:hover {filter:brightness(1.15);transform:translateY(-1px);}
.success {
  text-align:center;
  color:var(--success);
  font-size:18px;
  font-weight:600;
  display:none;
}
footer {
  text-align:center;
  color:var(--muted);
  font-size:12px;
  margin-top:20px;
}
</style>
</head>

<body>
<div class="card">
  <h2>üí≥ Secure Fashion Checkout</h2>
  <div id="orderSummary" class="summary"></div>

  <div class="method">
    <label><input type="radio" name="paymode" value="razorpay" checked> üí∏ Pay Online (UPI / Card / Netbanking)</label>
    <label><input type="radio" name="paymode" value="cod"> üßæ Cash on Delivery (COD)</label>
  </div>

  <button class="primary" id="payNow">Proceed to Pay</button>

  <div class="success" id="successMsg">
    ‚úÖ Payment Successful!<br><br>
    <button class="primary" onclick="window.location.href='index.html'">üè† Back to Store</button>
    <button class="primary" style="margin-top:10px" onclick="viewOrders()">üì¶ View My Orders</button>
  </div>
</div>

<footer>¬© 2025 Trendspy ‚Äî Secure Fashion Checkout</footer>

<script>
document.addEventListener("DOMContentLoaded",()=>{
 const payNow=document.getElementById('payNow');
 const successMsg=document.getElementById('successMsg');
 const orderSummary=document.getElementById('orderSummary');

 const currentOrder=JSON.parse(localStorage.getItem('currentOrder')||'null');
 const orders=JSON.parse(localStorage.getItem('orders')||'[]');
 const user=JSON.parse(localStorage.getItem('user')||'null');

 if(!currentOrder){
   orderSummary.innerHTML="<div>No active order found.</div>";
   payNow.disabled=true;
   return;
 }

 // Show Summary
 orderSummary.innerHTML=`
   <div><b>Order ID</b><span>${currentOrder.id}</span></div>
   <div><b>Name</b><span>${user?.name||'Guest'}</span></div>
   <div><b>Contact</b><span>${user?.contact||'N/A'}</span></div>
   <div><b>Total</b><span>${currentOrder.total}</span></div>
   <div><b>Status</b><span>${currentOrder.status}</span></div>
 `;

 // Payment Logic
 payNow.onclick=()=>{
   const mode=document.querySelector('input[name="paymode"]:checked')?.value;

   // üßæ COD Flow
   if(mode==='cod'){
     currentOrder.status="Pending";
     currentOrder.paymentMethod="Cash on Delivery";
     currentOrder.paymentStatus="Unpaid";
     currentOrder.paymentId="N/A";
     currentOrder.ts=new Date().toLocaleString();

     orders.push(currentOrder);
     localStorage.setItem('orders',JSON.stringify(orders));
     localStorage.removeItem('cart');
     localStorage.removeItem('currentOrder');
     triggerSync();

     payNow.style.display='none';
     successMsg.style.display='block';
     successMsg.innerHTML=`‚úÖ COD Order Placed Successfully!<br><small>Payment will be collected on delivery.</small><br><br>
       <button class="primary" onclick="window.location.href='index.html#orders'">üì¶ View My Orders</button>`;
     setTimeout(()=>window.location.href='index.html#orders',1500);
     return;
   }

   // üí≥ Razorpay Flow
   const amount=parseInt(currentOrder.total.replace(/[‚Çπ,]/g,''))*100;
   const options={
     key:"rzp_test_xxxxxxxxxxxxx", // Replace with real Razorpay key
     amount:amount,
     currency:"INR",
     name:"Trendspy Fashion",
     description:"Order Payment",
     image:"https://cdn-icons-png.flaticon.com/512/2977/2977817.png",
     handler:function(response){
       currentOrder.status="Paid";
       currentOrder.paymentMethod="Razorpay";
       currentOrder.paymentId=response.razorpay_payment_id;
       currentOrder.paymentStatus="Paid";
       currentOrder.ts=new Date().toLocaleString();

       orders.push(currentOrder);
       localStorage.setItem('orders',JSON.stringify(orders));
       localStorage.removeItem('cart');
       localStorage.removeItem('currentOrder');
       triggerSync();

       payNow.style.display='none';
       successMsg.style.display='block';
       setTimeout(()=>window.location.href='index.html#orders',1500);
     },
     prefill:{ name:user?.name||"Customer", contact:user?.contact||"" },
     theme:{color:"#ec4899"}
   };

   const rzp=new Razorpay(options);
   rzp.on('payment.failed',r=>{
     alert("‚ùå Payment Failed!\nReason: "+r.error.description);
   });
   rzp.open();
 };

 function triggerSync(){
   window.dispatchEvent(new StorageEvent('storage',{key:'orders',newValue:JSON.stringify(orders)}));
 }

 window.viewOrders=()=>window.location.href='index.html#orders';
});
</script>
</body>
</html>
